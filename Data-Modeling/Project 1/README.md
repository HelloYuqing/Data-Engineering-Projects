
## Introduction
A startup called Sparkify wants to analyze the data they've been collecting on songs and user activity on their new music streaming app. They'd like a data engineer to create a Postgres database with tables designed to optimize queries on song play analysis, and bring you on the project. Your role is to create a database schema and ETL pipeline for this analysis. 

### Song Dataset
Songs dataset is a subset of Million Song Dataset.

Sample record:

```{"num_songs": 1, "artist_id": "ARJIE2Y1187B994AB7", "artist_latitude": null, "artist_longitude": null, "artist_location": "", "artist_name": "Line Renaud", "song_id": "SOUPIRU12A6D4FA1E1", "title": "Der Kleine Dompfaff", "duration": 152.92036, "year": 0}```

### Log Dataset
Logs dataset is generated by Event Simulator.

Sample Record:

```{"artist": null, "auth": "Logged In", "firstName": "Walter", "gender": "M", "itemInSession": 0, "lastName": "Frye", "length": null, "level": "free", "location": "San Francisco-Oakland-Hayward, CA", "method": "GET","page": "Home", "registration": 1540919166796.0, "sessionId": 38, "song": null, "status": 200, "ts": 1541105830796, "userAgent": "\"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/36.0.1985.143 Safari\/537.36\"", "userId": "39"}```

## Design Schema
<img width="485" alt="image" src="https://user-images.githubusercontent.com/69694512/212037266-bd1c4a2e-ded5-48a5-a894-fdfd8c2784fe.png">

## Project Files
1. sql_queries.py -> contains sql queries for dropping and creating fact and dimension tables. Also, contains insertion query template.

2. create_tables.py -> contains code for setting up database. Running this file creates sparkifydb and also creates the fact and dimension tables.

3. etl.py -> read and process song_data and log_data

4. test.ipynb -> a notebook to connect to postgres db and validate the data loaded.

## Project Steps

### Create Tables
1. Write CREATE statements in sql_queries.py to create each table.
```
# CREATE TABLES
songplay_table_create = ("""CREATE TABLE IF NOT EXISTS songplays(
 songplay_id SERIAL CONSTRAINT songplay_pk PRIMARY KEY,
 start_time TIMESTAMP REFERENCES time (start_time),
 user_id INT REFERENCES users (user_id),
 level VARCHAR NOT NULL,
 song_id VARCHAR REFERENCES songs (song_id),
 artist_id VARCHAR REFERENCES artists (artist_id),
 session_id INT NOT NULL, 
 location VARCHAR,
 user_agent TEXT
)""")

```
```
user_table_create = ("""CREATE TABLE IF NOT EXISTS  users(
 user_id  INT CONSTRAINT users_pk PRIMARY KEY,
 first_name  VARCHAR,
 last_name  VARCHAR,
 gender  CHAR(1),
 level VARCHAR NOT NULL
)""")
```
```
artist_table_create = ("""CREATE TABLE  IF NOT EXISTS artists(
 artist_id VARCHAR CONSTRAINT artist_pk PRIMARY KEY,
 name VARCHAR,
 location VARCHAR,
 latitude DECIMAL(9,6),
 longitude DECIMAL(9,6)
)""")

```
```
time_table_create = ("""CREATE TABLE IF NOT EXISTS  time(
 start_time  TIMESTAMP CONSTRAINT time_pk PRIMARY KEY,
 hour INT NOT NULL CHECK (hour >= 0),
 day INT NOT NULL CHECK (day >= 0),
 week INT NOT NULL CHECK (week >= 0),
 month INT NOT NULL CHECK (month >= 0),
 year INT NOT NULL CHECK (year >= 0),
 weekday VARCHAR NOT NULL
)""")

```








































































































